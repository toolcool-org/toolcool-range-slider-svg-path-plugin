<!DOCTYPE html>
<html lang="en">
<head>
    <title>Car Example | Tool Cool Range Slider</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="css/styles.css" />
</head>
<body>

    <h1>Car</h1>

    <!-- icon source: https://www.svgrepo.com/svg/125/car -->
    <div class="wrapper">
        <div class="row">
            <tc-range-slider
              id="car-slider"

              value="0"
              round="0"

              generate-labels="false"

              svg-path="M5 5c25 49.875 50 74.8125 75 74.8125C117.5 79.8125 117.5 5 155 5s37.5 74.8125 75 74.8125S267.5 5 305 5s37.5 74.8125 75 74.8125S417.5 5 455 5s37.5 74.8125 75 74.8125c25 0 50-24.9375 75-74.8125"
              svg-path-stroke-width="10"

              pointer-width="50px"
              pointer-height="50px"

              pointer-bg="transparent url(img/car-svgrepo-com.svg) no-repeat 50% 50%"
              pointer-bg-hover="transparent url(img/car-svgrepo-com.svg) no-repeat 50% 50%"
              pointer-bg-focus="transparent url(img/car-svgrepo-com.svg) no-repeat 50% 50%"

              pointer-radius="0"
              pointer-border="none"
              pointer-border-hover="none"
              pointer-border-focus="none"
              pointer-shadow="none"
              pointer-shadow-hover="none"
              pointer-shadow-focus="none"

              slider-width="610px"
              slider-height="85px">
            </tc-range-slider>
        </div>
    </div>

    <script src="../dist/tcrs-svg-path.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/toolcool-range-slider/dist/plugins/tcrs-generated-labels.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toolcool-range-slider/dist/toolcool-range-slider.min.js"></script>
    <script src="js/svg-path-properties.min.js"></script>
    <script>
        const $slider = document.getElementById('car-slider');
        const $pointer = $slider.shadowRoot.querySelector('.pointer-0');

        const $path = $slider.shadowRoot.querySelector('.path-svg path');
        const d = $path.getAttribute('d');
        const properties = new svgPathProperties.svgPathProperties(d);

        let x = undefined;
        let y = undefined;

        $slider.addEventListener('change', (evt) => {

            const percent = Number($pointer.getAttribute('aria-valuenow')) ?? 0;
            const distance = $slider.shadowRoot.querySelector('.path-svg').getBoundingClientRect().width * percent / 100;

            const rect = $pointer.getBoundingClientRect();
            const _x = rect.x;
            const _y = rect.y;

            const tangent = properties.getTangentAtLength(distance);

            if(x !== undefined && y !== undefined){

                /*var firstPoint = path.getPointAtLength(scrollPercentage * pathLen);
                var secondPoint = path.getPointAtLength(scrollPercentage * (pathLen + 3));

//Get degree
                var deg = Math.atan2(firstPoint.y - secondPoint.y, firstPoint.x - secondPoint.x) * (180 / Math.PI);
                console.log(deg);
                var element = document.getElementById("wipe");
                element.setAttribute("transform", "translate("+ pt.x  + "," + pt.y + ") rotate(" + pt.deg + ")");*/

                /* determine angle of longest line segement relative to x axis */
                /*let dY = _y - y;
                let dX = _x - x;
                let angleInDegrees = Math.atan2(dY,dX) * (180 / Math.PI);

                /!* if text would be upside down, rotate through 180 degrees: *!/
                if( (angleInDegrees > 90 && angleInDegrees < 270) || (angleInDegrees < -90 && angleInDegrees > -270)) {
                    angleInDegrees += 180;
                    angleInDegrees %= 360;
                }*/
                const angleInDegrees = Math.atan2(tangent.y, tangent.x)* (180 / Math.PI);
                $pointer.style.transform = `rotate(${ angleInDegrees }deg`;

            }

            x = _x;
            y = _y;
        });
    </script>
</body>
</html>